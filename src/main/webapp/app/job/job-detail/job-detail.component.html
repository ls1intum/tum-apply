<jhi-confirm-dialog
  #closeConfirmDialog
  class="confirm-dialog"
  [header]="'myPositionsPage.confirmDialog.closeHeader' | translate"
  [message]="'myPositionsPage.confirmDialog.closeMessage' | translate"
  [label]="closeButtonLabel | translate"
  [severity]="closeButtonSeverity"
  [confirmIcon]="closeButtonIcon"
  [showOpenButton]="false"
  (confirmed)="onCloseJob()"
/>
<jhi-confirm-dialog
  #deleteConfirmDialog
  class="confirm-dialog"
  [header]="'myPositionsPage.confirmDialog.deleteHeader' | translate"
  [message]="'myPositionsPage.confirmDialog.deleteMessage' | translate"
  [label]="deleteButtonLabel | translate"
  [severity]="deleteButtonSeverity"
  [confirmIcon]="deleteButtonIcon"
  [showOpenButton]="false"
  (confirmed)="onDeleteJob()"
/>

@if (jobDetails(); as job) {
  <div [class]="isSummaryPage() ? '' : 'page-container'">
    <!-- Header Section -->
    <div class="header-container mb-8 border-b border-divider-default">
      <div class="flex flex-col gap-4">
        <h1 class="page-header">{{ job.title }}</h1>
        <div class="flex flex-row gap-8 flex-wrap md:gap-8 gap-4">
          <div class="flex items-center gap-2 text-sm">
            <fa-icon [icon]="['fas', 'user-tie']" class="icon" />
            <span><strong jhiTranslate="jobDetailPage.header.supervisor"></strong> {{ job.supervisingProfessor || '-' }}</span>
          </div>
          <div class="flex items-center gap-2 text-sm">
            <fa-icon [icon]="['fas', 'location-dot']" class="icon" />
            <span
              ><strong jhiTranslate="jobDetailPage.header.location"></strong>
              {{ (dropDownOptions.getLocationTranslationKey(job.location) | translate) || '-' }}</span
            >
          </div>
          <!-- display job state if the logged-in user belongs to the research group, display draft if form is in preview -->
          @if (previewData()) {
            <jhi-tag class="job-state-badge" [text]="'jobState.preview' | translate" [color]="'info'" />
          } @else if (job.belongsToResearchGroup) {
            <jhi-tag class="job-state-badge" [text]="jobStateText() | translate" [color]="jobStateColor()" />
          }
        </div>
      </div>
      <div class="flex flex-col items-start gap-4 md:flex-col md:items-end">
        <div class="flex items-center gap-2">
          @if (showPdfButtonForPreview()) {
            <jhi-button
              label="button.downloadPDF"
              severity="primary"
              variant="outlined"
              icon="file-pdf"
              [shouldTranslate]="true"
              (click)="onDownloadPDF()"
            />
          }
          @for (item of individualActionButtons(); track item.label) {
            <jhi-button
              [label]="item.label"
              [severity]="item.severity ?? 'secondary'"
              variant="outlined"
              [icon]="item.icon"
              [shouldTranslate]="true"
              (click)="item.command?.()"
            />
          }
          @if (shouldShowKebabMenu()) {
            <jhi-button
              severity="secondary"
              variant="outlined"
              icon="ellipsis-vertical"
              label="button.actions"
              [shouldTranslate]="true"
              (click)="menu.toggle($event)"
            />
            <jhi-menu #menu [items]="menuItems()" [shouldTranslate]="true" />
          }
          @if (primaryActionButton(); as primaryActionButton) {
            <jhi-button
              [label]="primaryActionButton.label"
              [severity]="primaryActionButton.severity ?? 'primary'"
              [variant]="primaryActionButton.variant"
              [icon]="primaryActionButton.icon"
              [disabled]="primaryActionButton.disabled ?? false"
              [shouldTranslate]="primaryActionButton.shouldTranslate ?? true"
              (click)="primaryActionButton.onClick()"
            />
          }
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 xl:grid-cols-[1fr_25rem] gap-8">
      <!-- Left Column: Text Sections -->
      <div class="flex flex-col gap-6 mb-2">
        <section>
          <!-- If applicant: show only the job description in the currently selected language (fallback to the other language if empty) -->
          @if (isProfessorOrEmployee()) {
            <div class="flex items-center gap-2">
              <h2 class="section-title">
                <span jhiTranslate="jobDetailPage.sections.jobDescriptionEN"></span>
              </h2>
              <fa-icon
                class="icon"
                [icon]="['fas', 'circle-info']"
                [pTooltip]="'jobDetailPage.tooltips.applicantLanguageInfo' | translate"
                tooltipPosition="top"
              ></fa-icon>
            </div>
            <div class="wrap-anywhere description-text leading-relaxed mb-6" [innerHTML]="job.jobDescriptionEN || '-'"></div>

            <h2 class="section-title" jhiTranslate="jobDetailPage.sections.jobDescriptionDE"></h2>
            <div class="wrap-anywhere description-text leading-relaxed" [innerHTML]="job.jobDescriptionDE || '-'"></div>
          } @else {
            <h2 class="section-title" jhiTranslate="jobDetailPage.sections.jobDescription"></h2>
            <div class="wrap-anywhere description-text leading-relaxed" [innerHTML]="jobDescriptionForCurrentLang() || '-'"></div>
          }
        </section>
      </div>

      <!-- Right Column: Cards -->
      <div class="flex flex-col">
        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'briefcase']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="jobDetailPage.cards.positionOverview"></h3>
          </div>
          <div class="section-card-body">
            <div class="info-list">
              <div class="info-row">
                <span jhiTranslate="jobDetailPage.labels.fieldOfStudies"></span>
                <span class="value">{{ (dropDownOptions.getFieldOfStudiesTranslationKey(job.fieldOfStudies) | translate) || '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="jobDetailPage.labels.researchArea"></span>
                <span class="value">{{ job.researchArea || '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="jobDetailPage.labels.workload"></span>
                @if (job.workload !== '') {
                  <span class="value">{{ job.workload }} <span jhiTranslate="jobDetailPage.units.hoursPerWeek"></span></span>
                } @else {
                  <span class="value">-</span>
                }
              </div>
              <div class="info-row">
                <span jhiTranslate="jobDetailPage.labels.contractDuration"></span>
                @if (job.contractDuration !== '') {
                  <span class="value">{{ job.contractDuration }} <span jhiTranslate="jobDetailPage.units.years"></span></span>
                } @else {
                  <span class="value">-</span>
                }
              </div>
              <div class="info-row">
                <span jhiTranslate="jobDetailPage.labels.fundingType"></span>
                <span class="value">{{ (dropDownOptions.getFundingTypeTranslationKey(job.fundingType) | translate) || '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="jobDetailPage.labels.startDate"></span>
                <span class="value">{{ (job.startDate | localizedDate) || '-' }}</span>
              </div>
              @if (job.endDate) {
                <div class="info-row">
                  <span jhiTranslate="jobDetailPage.labels.applicationEndDate"></span>
                  <span class="value text-negative-default">{{ job.endDate | localizedDate }}</span>
                </div>
              }
            </div>
          </div>
        </div>

        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'research-group']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="jobDetailPage.cards.researchGroup"></h3>
            @if (isProfessorOrEmployee() && job.belongsToResearchGroup) {
              <fa-icon
                [icon]="['fas', 'pencil']"
                class="icon edit-icon cursor-pointer ml-auto"
                (click)="onEditResearchGroup()"
                [pTooltip]="'button.edit' | translate"
                tooltipPosition="top"
              />
            }
          </div>
          <div class="section-card-body">
            <h4 class="text-base font-semibold mb-4">{{ job.researchGroup || '-' }}</h4>
            @if (hasResearchGroupDescription()) {
              <div class="leading-relaxed mb-4 text-sm wrap-anywhere" [innerHTML]="job.researchGroupDescription"></div>
            } @else {
              <div class="leading-relaxed mb-4 text-sm wrap-anywhere">{{ noData() }}</div>
            }

            @if (job.researchGroupEmail || job.researchGroupWebsite || job.researchGroupStreet) {
              <div class="mt-4">
                @if (job.researchGroupStreet) {
                  <div class="flex items-start gap-3 mb-3 text-sm">
                    <fa-icon [icon]="['fas', 'location-dot']" class="icon" />
                    <div>
                      <div>{{ job.researchGroupStreet }}</div>
                      <div>{{ job.researchGroupPostalCode }} {{ job.researchGroupCity }}</div>
                    </div>
                  </div>
                }
                @if (job.researchGroupEmail) {
                  <div class="flex items-start gap-3 mb-3 text-sm">
                    <fa-icon [icon]="['fas', 'envelope']" class="icon" />
                    <a class="link" [href]="'mailto:' + job.researchGroupEmail">{{ job.researchGroupEmail }}</a>
                  </div>
                }
                @if (job.researchGroupWebsite) {
                  <div class="flex items-start gap-3 mb-3 text-sm">
                    <fa-icon [icon]="['fas', 'globe']" class="icon" />
                    <a
                      class="link"
                      [href]="job.researchGroupWebsite"
                      [title]="job.researchGroupWebsite"
                      target="_blank"
                      rel="noopener noreferrer"
                      >{{ this.trimWebsiteUrl(job.researchGroupWebsite) }}</a
                    >
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Data Protection Information -->
    <section class="mb-8">
      <h2 class="section-title" jhiTranslate="jobDetailPage.sections.dataProtection"></h2>
      <div
        class="leading-relaxed text-sm p-4 bg-background-surface border-l-4 border-primary rounded-sm wrap-anywhere"
        [innerHTML]="'jobDetailPage.dataPrivacy.dataProtectionText' | translate"
      ></div>
    </section>

    @if (!previewData()) {
      <section class="mt-8 pt-8 border-t border-divider-default">
        <div class="flex justify-start">
          <jhi-button
            label="button.back"
            icon="arrow-left"
            severity="info"
            variant="outlined"
            (click)="onBack()"
            [shouldTranslate]="true"
          />
        </div>
      </section>
    }
  </div>
}
