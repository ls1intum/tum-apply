<div class="flex flex-col">
  <div>
    <div class="mb-3">
      <jhi-info-box severity="primary" message="researchGroup.members.notice" [shouldTranslate]="true" />
    </div>
    <!-- Search Bar -->
    <div class="w-full mb-3">
      <jhi-search-filter-sort-bar
        [searchText]="'researchGroup.members.searchPlaceholder' | translate"
        [totalRecords]="totalRecords()"
        [singleEntity]="'researchGroup.members.singleEntity' | translate"
        [multipleEntities]="'researchGroup.members.multipleEntities' | translate"
        (searchOutput)="onSearch($event)"
      >
        <span records-extra class="text-sm text-text-secondary">
          @if (selectedUserCount() === 1) {
            {{ 'researchGroup.members.selectedCountSingle' | translate: { count: selectedUserCount() } }}
          } @else if (selectedUserCount() > 1) {
            {{ 'researchGroup.members.selectedCountMultiple' | translate: { count: selectedUserCount() } }}
          }
        </span>
      </jhi-search-filter-sort-bar>
    </div>

    <!-- User List -->
    <div
      class="flex flex-col overflow-y-auto border border-border-default rounded-lg"
      [class.h-96]="loading()"
      [class.max-h-96]="!loading()"
    >
      @if (loading()) {
        <div class="flex items-center justify-center h-full bg-background-default rounded-lg">
          <p-progressSpinner styleClass="w-10 h-10 text-text-primary" />
        </div>
      }

      @if (!loading() && users().length === 0 && searchQuery() === '') {
        <div class="p-8 text-center text-text-secondary">
          {{ 'researchGroup.members.emptySearch' | translate: { minLength: MIN_SEARCH_LENGTH } }}
        </div>
      }

      @if (!loading() && users().length === 0 && searchQuery() !== '') {
        <div class="p-8 text-center text-text-secondary">
          {{ 'researchGroup.members.noUsers' | translate }}
        </div>
      }

      @if (!loading() && users().length !== 0) {
        @for (user of users(); track user.id) {
          <div
            class="flex items-center gap-3 p-3 cursor-pointer transition-colors"
            [class.bg-background-surface-alt]="isUserSelected(user)"
            [class.hover:bg-background-surface-alt]="isUserSelected(user)"
            [class.hover:bg-background-surface]="!isUserSelected(user)"
            role="button"
            tabindex="0"
            (click)="toggleUserSelection(user)"
          >
            <div
              class="flex-shrink-0 w-8 h-8 rounded-full bg-primary-default flex items-center justify-center text-text-on-primary font-semibold"
            >
              {{ user.firstName ? user.firstName.charAt(0) : '' }}{{ user.lastName ? user.lastName.charAt(0) : '' }}
            </div>
            <div class="flex-1">
              <div class="font-medium text-text-primary">{{ user.firstName }} {{ user.lastName }}</div>
              <div class="text-sm text-text-secondary">{{ user.email }}</div>
            </div>
            <jhi-checkbox
              class="self-center"
              [model]="isUserSelected(user)"
              [errorEnabled]="false"
              (click)="$event.stopPropagation(); toggleUserSelection(user)"
            />
          </div>
        }
      }
    </div>
  </div>

  <!-- Pagination -->
  @if (totalRecords() > 0 && totalRecords() > pageSize()) {
    <div class="flex justify-center">
      <p-paginator
        [rows]="pageSize()"
        [totalRecords]="totalRecords()"
        [first]="page() * pageSize()"
        (onPageChange)="onPageChange($event)"
      />
    </div>
  }

  <!-- Action Buttons -->
  <div class="flex justify-end gap-2 mt-4">
    <jhi-button [label]="'button.cancel' | translate" severity="secondary" variant="outlined" (click)="onCancel()" />

    <jhi-button
      [label]="'researchGroup.members.addMembersButton' | translate"
      icon="user-plus"
      severity="primary"
      [disabled]="selectedUserCount() === 0"
      [tooltip]="'researchGroup.members.addMembersButton' | translate"
      (click)="onAddMembers()"
    />
  </div>
</div>
