<div class="page-container">
  <div class="header-container">
    <div class="page-header">
      <h1 jhiTranslate="researchGroup.adminView.title" class="h1-text"></h1>
    </div>
    <jhi-button
      [label]="'researchGroup.adminView.createButton' | translate"
      icon="plus"
      severity="primary"
      (click)="onCreateResearchGroup()"
      [shouldTranslate]="false"
    />
  </div>
  <div class="body">
    <jhi-search-filter-sort-bar
      [searchText]="'researchGroup.adminView.searchFilterSortBar.searchText' | translate"
      [totalRecords]="totalRecords()"
      [singleEntity]="'researchGroup.adminView.group' | translate"
      [multipleEntities]="'researchGroup.adminView.groups' | translate"
      [filters]="filters"
      (searchOutput)="onSearchEmit($event)"
      (filterOutput)="onFilterEmit($event)"
      (sortOutput)="loadOnSortEmit($event)"
      [sortableFields]="sortableFields"
    />

    <div class="table-wrapper">
      <jhi-dynamic-table
        [columns]="columns()"
        [data]="researchGroups()"
        [totalRecords]="totalRecords()"
        [page]="page()"
        [rows]="pageSize()"
        [selectable]="true"
        (lazyLoad)="loadOnTableEmit($event)"
      />
    </div>

    <ng-template #actionTemplate let-researchGroup>
      <div class="flex space-x-2">
        <jhi-button
          icon="eye"
          [ariaLabel]="'button.view' | translate"
          [tooltip]="'button.view' | translate"
          severity="primary"
          variant="text"
          (click)="onViewResearchGroup(researchGroup.id)"
        />
        @if (researchGroup.status !== 'DENIED') {
          <jhi-button
            icon="users"
            [ariaLabel]="'researchGroup.members.manageMembers' | translate"
            [tooltip]="'researchGroup.members.manageMembers' | translate"
            severity="primary"
            variant="text"
            (click)="onManageMembers(researchGroup.id)"
          />
        }
        @if (researchGroup.status === 'ACTIVE') {
          <jhi-confirm-dialog
            [label]="'button.withdraw' | translate"
            [iconOnly]="true"
            [header]="'researchGroup.adminView.withdrawConfirmDialog.header' | translate"
            [message]="'researchGroup.adminView.withdrawConfirmDialog.message' | translate"
            confirmIcon="withdraw"
            (confirmed)="onWithdrawResearchGroup(researchGroup.id)"
            severity="danger"
            [tooltip]="'button.withdraw' | translate"
          />
        }
        @if (researchGroup.status === 'DRAFT') {
          <jhi-confirm-dialog
            [label]="'button.confirm' | translate"
            [iconOnly]="true"
            [header]="'researchGroup.adminView.confirmDialog.header' | translate"
            [message]="'researchGroup.adminView.confirmDialog.message' | translate"
            confirmIcon="check"
            (confirmed)="onApproveResearchGroup(researchGroup.id)"
            severity="success"
            [tooltip]="'button.confirm' | translate"
          />
          <jhi-confirm-dialog
            [label]="'button.deny' | translate"
            [iconOnly]="true"
            [header]="'researchGroup.adminView.denyConfirmDialog.header' | translate"
            [message]="'researchGroup.adminView.denyConfirmDialog.message' | translate"
            confirmIcon="times"
            (confirmed)="onDenyResearchGroup(researchGroup.id)"
            severity="danger"
            [tooltip]="'button.deny' | translate"
          />
        }
        @if (researchGroup.status === 'DENIED') {
          <jhi-confirm-dialog
            [label]="'button.confirm' | translate"
            [iconOnly]="true"
            [header]="'researchGroup.adminView.confirmDialog.header' | translate"
            [message]="'researchGroup.adminView.confirmDialog.message' | translate"
            confirmIcon="check"
            (confirmed)="onApproveResearchGroup(researchGroup.id)"
            severity="success"
            [tooltip]="'button.confirm' | translate"
          />
        }
      </div>
    </ng-template>

    <ng-template #stateTemplate let-researchGroup>
      <jhi-tag
        [text]="
          stateTextMap()[researchGroup.status]
            ? (stateTextMap()[researchGroup.status] | translate)
            : ('researchGroup.adminView.groupState.unknown' | translate)
        "
        [color]="stateSeverityMap()[researchGroup.status] || 'info'"
        width="8rem"
      />
    </ng-template>
  </div>
</div>
