<div class="page-container flex flex-col">
  <!-- Header -->
  <div class="page-header">
    <h1 jhiTranslate="interview.booking.title">Select your Interview Slot</h1>
  </div>

  @if (isClosed()) {
    <div class="p-4 max-w-3xl mx-auto mt-8 w-full">
      <jhi-info-box variant="danger" [icon]="'ban'">
        <div class="flex flex-col gap-1">
          <span class="font-semibold" jhiTranslate="interview.booking.closedProcess.title">Process Closed</span>
          <span jhiTranslate="interview.booking.closedProcess.description"
            >This interview process is now closed. You can no longer book or change interview slots.</span
          >
        </div>
      </jhi-info-box>
    </div>
  } @else if (error()) {
    <div class="p-4">
      <div class="font-bold text-negative-default mb-1" jhiTranslate="interview.booking.error.title">Error</div>
      <div class="text-negative-default" jhiTranslate="interview.booking.error.description">Unable to load booking data.</div>
    </div>
  } @else if (bookingData()) {
    @if (hasBookedSlot()) {
      <!-- Already Booked (Success Screen) -->
      <div class="max-w-3xl mx-auto flex flex-col items-center justify-center py-12 text-center">
        <!-- Success Icon -->
        <div class="text-positive-default mb-6 inline-flex items-center justify-center">
          <fa-icon icon="check" class="text-5xl" />
        </div>

        <h2 class="text-2xl font-bold mb-2 text-text-primary" jhiTranslate="interview.booking.success.title">Interview Booked!</h2>
        <p class="text-text-secondary mb-8" jhiTranslate="interview.booking.success.message">
          You have successfully booked your interview slot.
        </p>

        <!-- Booking Details Card -->
        <div class="bg-background-default border border-border-default rounded-lg p-8 w-full text-left">
          <!-- Job Info -->
          <div class="mb-6 border-b border-border-default pb-6">
            <div class="text-sm text-text-secondary mb-1" jhiTranslate="interview.booking.topic">Topic</div>
            <div class="flex items-center gap-2">
              <fa-icon icon="briefcase" class="text-primary" />
              <h3 class="text-base text-text-primary">{{ jobTitle() }}</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
              <!-- Supervisor -->
              <div>
                <div class="text-sm text-text-secondary mb-1" jhiTranslate="interview.booking.supervisor">Supervisor</div>
                <div class="flex items-center gap-2">
                  <fa-icon icon="user-tie" class="text-primary" />
                  <span class="text-base text-text-primary">{{ supervisorName() }}</span>
                </div>
              </div>

              <!-- Research Group -->
              @if (researchGroupName()) {
                <div>
                  <div class="text-sm text-text-secondary mb-1" jhiTranslate="interview.booking.researchGroup">Research Group</div>
                  <div class="flex items-center gap-2">
                    <fa-icon icon="research-group" class="text-primary" />
                    <span class="text-base text-text-primary">{{ researchGroupName() }}</span>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Slot Info -->
          <div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Date -->
              <div>
                <div class="text-sm text-text-secondary mb-1" jhiTranslate="interview.booking.date">Date</div>
                <div class="flex items-center gap-2">
                  <fa-icon icon="calendar" class="text-sm text-primary" />
                  <span class="text-base text-text-primary">{{ bookedSlotDate() }}</span>
                </div>
              </div>

              <!-- Time -->
              <div>
                <div class="text-sm text-text-secondary mb-1" jhiTranslate="interview.booking.time">Time</div>
                <div class="flex items-center gap-2">
                  <fa-icon icon="clock" class="text-sm text-primary" />
                  <span class="text-base text-text-primary">{{ bookedSlotTime() }}</span>
                </div>
              </div>

              <!-- Location -->
              <div>
                <div class="text-sm text-text-secondary mb-1" jhiTranslate="interview.booking.location">Location</div>
                <div class="flex items-center gap-2">
                  <fa-icon [icon]="isBookedVirtual() ? 'video' : 'location-dot'" class="text-sm text-primary" />
                  <span class="text-base text-text-primary">{{ bookedSlotLocation() }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    } @else {
      <!-- Booking Selection -->
      <div class="flex flex-col lg:flex-row gap-8 items-stretch w-full min-h-[calc(100vh-12rem)]">
        <!-- LEFT: Slots Section -->
        <div class="flex-1 flex flex-col min-w-0">
          <!-- Navigation Header -->
          <div class="flex items-center gap-8 mb-6">
            <div class="flex items-center gap-4">
              <jhi-button icon="chevron-left" variant="text" size="sm" (click)="previousMonth()" />
              <span class="text-lg font-bold min-w-[10rem] text-center">
                {{ currentMonthLabel() }}
              </span>
              <jhi-button icon="chevron-right" variant="text" size="sm" (click)="nextMonth()" />
            </div>
          </div>

          <!-- Slots Columns -->
          @if (currentMonthSlots().length === 0) {
            <div class="flex flex-col items-center justify-center min-h-[20rem] text-text-secondary">
              <fa-icon icon="calendar-xmark" class="text-4xl mb-4" />
              <span jhiTranslate="interview.booking.noSlotsInMonth">No slots available this month</span>
            </div>
          } @else {
            <div class="flex items-start gap-4">
              <!-- Left Arrow -->
              <div class="flex-shrink-0 pt-2">
                <jhi-button icon="chevron-left" variant="text" size="sm" [disabled]="!canGoPreviousDate()" (click)="previousDatePage()" />
              </div>

              <!-- Slots Grid -->
              <div class="flex-1 min-w-0 overflow-hidden">
                <div class="grid gap-4" style="grid-template-columns: repeat(auto-fit, minmax(min(100%, 13.75rem), 1fr))">
                  @for (group of paginatedSlots(); track group.date) {
                    <div class="flex flex-col gap-3">
                      <!-- Date Header -->
                      <jhi-date-header [date]="group.localDate" [slotCount]="group.slots.length" />

                      <!-- Slots List -->
                      <div class="flex flex-col gap-3">
                        @for (slot of getVisibleSlots(group.date, group.slots); track slot.id) {
                          <jhi-selectable-slot-card
                            [slot]="slot"
                            [selected]="selectedSlot()?.id === slot.id"
                            (slotSelected)="onSlotSelected($event)"
                          />
                        }

                        @if (group.slots.length > MAX_VISIBLE_SLOTS) {
                          <jhi-button
                            [fullWidth]="true"
                            variant="text"
                            [icon]="isExpanded(group.date) ? 'chevron-up' : 'chevron-down'"
                            [label]="
                              isExpanded(group.date)
                                ? 'interview.detail.showLess'
                                : getShowMoreText(getRemainingCount(group.date, group.slots.length))
                            "
                            [shouldTranslate]="isExpanded(group.date)"
                            styleClass="w-full py-2 border border-border-default rounded-md text-text-secondary text-sm font-medium flex items-center justify-center gap-1.5 hover:bg-background-surface transition-all"
                            (click)="toggleExpanded(group.date)"
                          />
                        }
                      </div>
                    </div>
                  }
                </div>
              </div>

              <!-- Right Arrow -->
              <div class="flex-shrink-0 pt-2">
                <jhi-button icon="chevron-right" variant="text" size="sm" [disabled]="!canGoNextDate()" (click)="nextDatePage()" />
              </div>
            </div>
          }
        </div>

        <!-- DIVIDER -->
        <div class="w-px bg-border-default self-stretch hidden lg:block"></div>

        <!-- Right Sidebar: Booking Summary -->
        <div class="w-full lg:w-[20rem] flex-shrink-0 flex flex-col lg:sticky lg:top-4 lg:self-start">
          <div class="flex-1 flex flex-col">
            <jhi-booking-summary
              [jobTitle]="jobTitle()"
              [supervisor]="supervisor()"
              [researchGroupName]="researchGroupName()"
              [selectedSlot]="selectedSlot()"
              [alreadyBooked]="hasBookedSlot()"
              [bookedDate]="bookedSlotDate()"
              [bookedTime]="bookedSlotTime()"
              [bookedIsVirtual]="isBookedVirtual()"
              [bookedLocation]="bookedSlotLocation()"
              (book)="onBook()"
            />
          </div>
        </div>
      </div>
    }
  }
</div>
