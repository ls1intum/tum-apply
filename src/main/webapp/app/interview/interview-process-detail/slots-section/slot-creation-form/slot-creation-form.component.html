<jhi-dialog
  [visible]="visible()"
  (visibleChange)="close()"
  [header]="'interview.slots.create.title'"
  width="95vw"
  maxWidth="80rem"
  height="90vh"
  [contentStyle]="{ overflow: 'hidden', display: 'flex', flexDirection: 'column', height: '100%' }"
>
  <div
    class="flex h-full flex-col gap-6 overflow-y-auto lg:overflow-hidden lg:grid lg:grid-cols-[26rem_auto_1fr] lg:grid-rows-[auto_1fr] lg:gap-x-4 lg:gap-y-6"
  >
    <!-- Duration-->
    <div class="flex flex-col gap-1 lg:col-start-1 lg:row-start-1">
      <div class="flex items-center gap-2">
        <span class="text-s font-semibold text-text-primary">{{ 'interview.slots.create.interviewLength' | translate }}</span>
        <fa-icon
          [icon]="['fas', 'circle-info']"
          class="text-primary-default"
          [pTooltip]="'interview.slots.create.durationTooltip' | translate"
          tooltipPosition="top"
        />
      </div>
      <div class="flex w-full items-center rounded bg-background-surface dark:bg-background-surface-alt p-1 gap-1">
        @for (option of durationOptions; track option.value) {
          <jhi-segment-button
            [label]="option.label"
            class="flex-1"
            [active]="!isCustomDurationMode() && duration() === option.value"
            (buttonClick)="selectDuration(option.value)"
          />
        }
        <jhi-segment-button
          label="interview.slots.create.custom"
          class="flex-1"
          [shouldTranslate]="true"
          [active]="isCustomDurationMode()"
          (buttonClick)="selectDuration(-1)"
        />
      </div>
      @if (isCustomDurationMode()) {
        <div class="flex flex-col mt-0.5 -mb-2">
          <div class="flex items-start gap-1">
            <jhi-number-input
              [model]="customDuration() ?? undefined"
              (modelChange)="onCustomDurationInput($event)"
              [min]="1"
              [max]="480"
              inputStyleClass="h-8 w-[4.25rem] text-center text-xs"
              [errorEnabled]="false"
            />
            <span class="text-text-secondary text-xs mt-2">min</span>
          </div>
          @if (durationError()) {
            <span class="text-s text-negative-default mt-0.5 block">{{ durationError() | translate }}</span>
          }
        </div>
      }
    </div>

    <!-- Break-->
    <div class="flex flex-col gap-1 w-full lg:w-[26rem] lg:col-start-3 lg:row-start-1">
      <div class="flex items-center gap-2">
        <span class="text-s font-semibold text-text-primary">{{ 'interview.slots.create.interviewBreaks' | translate }}</span>
        <fa-icon
          [icon]="['fas', 'circle-info']"
          class="text-primary-default"
          [pTooltip]="'interview.slots.create.breakTooltip' | translate"
          tooltipPosition="top"
        />
      </div>
      <div class="flex w-full items-center rounded bg-background-surface dark:bg-background-surface-alt p-1 gap-1">
        @for (option of breakOptions; track option.value) {
          <jhi-segment-button
            [label]="option.label"
            class="flex-1"
            [active]="!isCustomBreakMode() && breakDuration() === option.value"
            (buttonClick)="selectBreak(option.value)"
          />
        }

        <jhi-segment-button
          label="interview.slots.create.custom"
          class="flex-1"
          [shouldTranslate]="true"
          [active]="isCustomBreakMode()"
          (buttonClick)="selectBreak(-1)"
        />
      </div>
      @if (isCustomBreakMode()) {
        <div class="flex flex-col mt-0.5 -mb-2">
          <div class="flex items-start gap-1">
            <jhi-number-input
              [model]="customBreak() ?? undefined"
              (modelChange)="onCustomBreakInput($event)"
              [min]="0"
              [max]="120"
              inputStyleClass="h-8 w-[4.25rem] text-center text-xs"
              [errorEnabled]="false"
            />
            <span class="text-xs text-text-secondary mt-2">min</span>
          </div>
          @if (breakError()) {
            <span class="text-xs text-negative-default mt-0.5 block">{{ breakError() | translate }}</span>
          }
        </div>
      }
    </div>

    <!-- Calendar-->
    <div class="flex flex-col gap-2 lg:col-start-1 lg:row-start-2">
      <h3 class="text-s font-semibold">{{ 'interview.slots.create.selectDates' | translate }}</h3>
      <div
        class="flex justify-center [&_.p-datepicker-title]:text-text-primary [&_.p-datepicker-header]:bg-transparent [&_.p-datepicker-today>.p-datepicker-day]:bg-[var(--p-primary-hover-color-outlined)] [&_.p-datepicker-today>.p-datepicker-day]:text-text-primary [&_.p-datepicker-day:not(.p-disabled):not(.p-highlight):hover]:bg-primary-default [&_.p-datepicker-day:not(.p-disabled):not(.p-highlight):hover]:text-text-on-primary [&_.p-datepicker-month:not(.p-disabled):hover]:bg-primary-default [&_.p-datepicker-month:not(.p-disabled):hover]:text-text-on-primary [&_.p-datepicker-year:not(.p-disabled):hover]:bg-primary-default [&_.p-datepicker-year:not(.p-disabled):hover]:text-text-on-primary [&_.p-highlight]:bg-primary-default [&_.p-highlight]:text-text-on-primary [&_.p-highlight]:border-primary-default"
      >
        <p-datepicker
          [inline]="true"
          [selectionMode]="'multiple'"
          [minDate]="minDate"
          [ngModel]="selectedDatesSignal()"
          (ngModelChange)="onDateSelect($event)"
          styleClass="w-full border-0"
        />
      </div>
    </div>

    <!-- Divider-->
    <div class="hidden lg:block lg:col-start-2 lg:row-start-2">
      <p-divider layout="vertical" styleClass="h-full" />
    </div>

    <!-- Slots List-->
    <div class="flex flex-col gap-2 min-h-0 lg:overflow-hidden lg:col-start-3 lg:row-start-2">
      <h3 class="text-s font-semibold">{{ 'interview.slots.create.create' | translate }}</h3>

      @if (sortedDates().length === 0) {
        <div class="flex h-full flex-col items-center justify-center text-text-secondary">
          <fa-icon [icon]="['fas', 'calendar-plus']" class="text-4xl mb-4 text-text-secondary" />
          <h4 class="text-lg font-medium">{{ 'interview.slots.create.noDateSelected' | translate }}</h4>
          <p>{{ 'interview.slots.create.noDateSelectedDesc' | translate }}</p>
        </div>
      } @else {
        <div class="flex-1 lg:overflow-y-auto pr-2">
          <div class="flex flex-col gap-4 pb-4">
            @for (date of sortedDates(); track date.getTime(); let i = $index) {
              <jhi-date-slot-card
                [date]="date"
                [duration]="duration()"
                [breakDuration]="breakDuration()"
                [existingSlots]="slotsByDate().get(date.toISOString().split('T')[0]) || []"
                [showApplyAll]="i === 0 && sortedDates().length > 1"
                [showValidationErrors]="showValidationErrors()"
                (slotsChange)="updateSlotsForDate(date, $event)"
                (applyAll)="copySlotsToAllDays()"
                (remove)="removeDate(date)"
              />
            }

            <div class="mt-2 flex justify-end py-3">
              <jhi-button
                [label]="'interview.slots.create.saveSlots'"
                [shouldTranslate]="true"
                size="md"
                (click)="submit()"
                [loading]="isSubmitting()"
                [disabled]="isSubmitting()"
              />
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</jhi-dialog>
