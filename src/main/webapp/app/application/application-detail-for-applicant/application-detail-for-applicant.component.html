<jhi-confirm-dialog
  #withdrawConfirmDialog
  class="confirm-dialog"
  [header]="'entity.applicationOverview.dialogs.withdrawHeader' | translate"
  [message]="'entity.applicationOverview.dialogs.withdrawMessage' | translate"
  [label]="'button.withdraw' | translate"
  severity="danger"
  confirmIcon="withdraw"
  [showOpenButton]="false"
  (confirmed)="onWithdrawApplication()"
/>
<jhi-confirm-dialog
  #deleteConfirmDialog
  class="confirm-dialog"
  [header]="'entity.applicationOverview.dialogs.deleteHeader' | translate"
  [message]="'entity.applicationOverview.dialogs.deleteMessage' | translate"
  [label]="'button.delete' | translate"
  severity="danger"
  confirmIcon="trash"
  [showOpenButton]="false"
  (confirmed)="onDeleteApplication()"
/>

<div [class]="isSummaryPage() ? '' : 'page-container'">
  @if (application(); as application) {
    @if (!previewDetailData()) {
      <!-- Header Section -->
      <div class="header-container">
        <div class="flex flex-col gap-2">
          <div class="flex items-center gap-2">
            <jhi-back-button />
            <h1
              class="page-header"
              jhiTranslate="entity.application_detail.applicant.header"
              [translateValues]="{ jobTitle: application.jobTitle }"
            ></h1>
          </div>
          <jhi-application-state-for-applicants [state]="application.applicationState" />
        </div>
        <div class="flex items-center gap-2">
          @for (item of individualActionButtons(); track item.label) {
            <jhi-button
              [label]="item.label"
              [severity]="item.severity ?? 'primary'"
              [variant]="item.severity === 'danger' ? undefined : 'outlined'"
              [icon]="item.icon"
              [shouldTranslate]="true"
              (click)="item.command?.()"
            />
          }
          @if (shouldShowKebabMenu()) {
            <jhi-button
              severity="primary"
              variant="outlined"
              icon="ellipsis-vertical"
              label="button.actions"
              [shouldTranslate]="true"
              (click)="menu.toggle($event)"
            />
            <jhi-menu #menu [items]="menuItems()" [shouldTranslate]="true" />
          }
          @if (primaryActionButton(); as primaryActionButton) {
            <jhi-button
              [label]="primaryActionButton.label"
              [severity]="primaryActionButton.severity ?? 'primary'"
              [variant]="primaryActionButton.variant"
              [icon]="primaryActionButton.icon"
              [disabled]="primaryActionButton.disabled ?? false"
              [shouldTranslate]="primaryActionButton.shouldTranslate ?? true"
              (click)="primaryActionButton.onClick()"
            />
          }
        </div>
      </div>

      <!-- Position Overview Section -->
      <section class="section-card">
        <div class="section-header">
          <h2 class="section-title" jhiTranslate="entity.application_detail.position_overview"></h2>
          <jhi-button
            [label]="'entity.application_detail.view_job_details'"
            [shouldTranslate]="true"
            severity="primary"
            variant="outlined"
            (click)="onViewJobDetails()"
          />
        </div>
        <div class="overview-content">
          <div class="info-item">
            <fa-icon [icon]="['fas', 'user-tie']" class="icon" />
            <span jhiTranslate="entity.application_detail.supervisor"></span>
            <span class="value">{{ application.supervisingProfessorName || '-' }}</span>
          </div>
          <div class="info-item">
            <fa-icon [icon]="['fas', 'research-group']" class="icon" />
            <span jhiTranslate="entity.application_detail.research_group"></span>
            <span class="value">{{ application.researchGroup || '-' }}</span>
          </div>
          <div class="info-item">
            <fa-icon [icon]="['fas', 'location-dot']" class="icon" />
            <span jhiTranslate="entity.application_detail.location"></span>
            <span class="value">{{ (dropDownOptions.getLocationTranslationKey(application.jobLocation) | translate) || '-' }}</span>
          </div>
        </div>
      </section>
    } @else {
      <!-- Header Section for Summary/Preview -->
      <div class="header-container mb-8 border-b border-divider-default">
        <div></div>
        <div class="flex flex-col items-start gap-4 md:flex-col md:items-end">
          <div class="flex items-center gap-2">
            @if (showPdfButtonForPreview()) {
              <jhi-button
                label="button.downloadPDF"
                severity="primary"
                variant="outlined"
                icon="file-pdf"
                [shouldTranslate]="true"
                (click)="onDownloadPDF()"
              />
            }
          </div>
        </div>
      </div>
    }

    <!-- Main Content Grid -->
    <div class="content-grid">
      <!-- Personal Statements Section -->
      <section>
        @if (!previewDetailData()) {
          <h2 class="section-title" jhiTranslate="entity.application_detail.personal_statements"></h2>
        }

        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'rocket']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="entity.applicationDetail.motivation"></h3>
          </div>
          <div class="section-card-body">
            <div class="content" [innerHTML]="application.motivation"></div>
          </div>
        </div>

        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'brain']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="entity.applicationDetail.skills"></h3>
          </div>
          <div class="section-card-body">
            <div class="content" [innerHTML]="application.specialSkills"></div>
          </div>
        </div>

        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'flask']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="entity.applicationDetail.researchExperience"></h3>
          </div>
          <div class="section-card-body">
            <div class="content" [innerHTML]="application.projects"></div>
          </div>
        </div>
      </section>

      <!-- Personal Information Section -->
      <section>
        @if (!previewDetailData()) {
          <h2 class="section-title" jhiTranslate="entity.application_detail.personal_information"></h2>
        }

        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'circle-user']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="entity.detail_card.applicant_info"></h3>
          </div>
          <div class="section-card-body">
            <div class="info-list">
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.desired_start_date"></span>
                <span class="value">{{ application.desiredDate ? (application.desiredDate | localizedDate) : '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.gender"></span>
                <span class="value">{{
                  application.applicant?.user?.gender ? ('genders.' + application.applicant?.user?.gender | translate) : '-'
                }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.nationality"></span>
                <span class="value">{{
                  application.applicant?.user?.nationality ? ('nationalities.' + application.applicant?.user?.nationality | translate) : '-'
                }}</span>
              </div>
            </div>
            @if (application.applicant?.user?.website || application.applicant?.user?.linkedinUrl) {
              <div class="links">
                @if (application.applicant?.user?.website) {
                  <div class="link-container">
                    <fa-icon [icon]="['fas', 'link']" class="icon" />
                    <a class="link" [href]="application.applicant?.user?.website" target="_blank" rel="noopener noreferrer">
                      <span jhiTranslate="entity.detail_card.website"></span>
                    </a>
                  </div>
                }
                @if (application.applicant?.user?.linkedinUrl) {
                  <div class="link-container">
                    <fa-icon [icon]="['fab', 'linkedin']" class="icon" />
                    <a class="link" [href]="application.applicant?.user?.linkedinUrl" target="_blank" rel="noopener noreferrer">
                      <span jhiTranslate="entity.detail_card.linkedin"></span>
                    </a>
                  </div>
                }
              </div>
            }
          </div>
        </div>

        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'graduation-cap']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="entity.detail_card.bachelor_info"></h3>
          </div>
          <div class="section-card-body">
            <div class="info-list">
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.name"></span>
                <span class="value">{{ application.applicant?.bachelorDegreeName || '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.university"></span>
                <span class="value">{{ application.applicant?.bachelorUniversity || '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.grade"></span>
                <span class="value">{{ bachelorGradeDisplay() }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="section-detail-card">
          <div class="section-card-header">
            <fa-icon [icon]="['fas', 'graduation-cap']" class="icon" />
            <h3 class="section-card-title" jhiTranslate="entity.detail_card.master_info"></h3>
          </div>
          <div class="section-card-body">
            <div class="info-list">
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.name"></span>
                <span class="value">{{ application.applicant?.masterDegreeName || '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.university"></span>
                <span class="value">{{ application.applicant?.masterUniversity || '-' }}</span>
              </div>
              <div class="info-row">
                <span jhiTranslate="entity.detail_card.grade"></span>
                <span class="value">{{ masterGradeDisplay() }}</span>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Documents Section -->
    @if (documentIds(); as documentIds) {
      <section class="documents-section">
        @if (
          documentIds.bachelorDocumentDictionaryIds ||
          documentIds.masterDocumentDictionaryIds ||
          documentIds.cvDocumentDictionaryId ||
          documentIds.referenceDocumentDictionaryIds
        ) {
          @if (!previewDetailData()) {
            <h2 class="section-title" jhiTranslate="entity.application_detail.personal_documents"></h2>
          }
        }
        <!-- Document grid for all document types -->
        <div class="document-container">
          @if (documentIds.bachelorDocumentDictionaryIds; as bachelorDocs) {
            @for (doc of bachelorDocs; track $index) {
              <div class="section-detail-card">
                <div class="section-card-header">
                  <fa-icon [icon]="['fas', 'file-lines']" class="icon" />
                  <h3 class="section-card-title" jhiTranslate="entity.upload.document_type.BACHELOR_TRANSCRIPT"></h3>
                </div>
                <div class="section-card-body">
                  <div class="document-viewer">
                    <jhi-document-viewer [documentDictionaryId]="doc" />
                  </div>
                </div>
              </div>
            }
          }

          @if (documentIds.masterDocumentDictionaryIds; as masterDocs) {
            @for (doc of masterDocs; track $index) {
              <div class="section-detail-card">
                <div class="section-card-header">
                  <fa-icon [icon]="['fas', 'file-lines']" class="icon" />
                  <h3 class="section-card-title" jhiTranslate="entity.upload.document_type.MASTER_TRANSCRIPT"></h3>
                </div>
                <div class="section-card-body">
                  <div class="document-viewer">
                    <jhi-document-viewer [documentDictionaryId]="doc" />
                  </div>
                </div>
              </div>
            }
          }

          @if (documentIds.cvDocumentDictionaryId; as cvDoc) {
            <div class="section-detail-card">
              <div class="section-card-header">
                <fa-icon [icon]="['fas', 'file-lines']" class="icon" />
                <h3 class="section-card-title" jhiTranslate="entity.upload.document_type.CV"></h3>
              </div>
              <div class="section-card-body">
                <div class="document-viewer">
                  <jhi-document-viewer [documentDictionaryId]="cvDoc" />
                </div>
              </div>
            </div>
          }

          @if (documentIds.referenceDocumentDictionaryIds; as referenceDocs) {
            @for (doc of referenceDocs; track $index) {
              <div class="section-detail-card">
                <div class="section-card-header">
                  <fa-icon [icon]="['fas', 'file-lines']" class="icon" />
                  <h3 class="section-card-title" jhiTranslate="entity.upload.document_type.REFERENCES"></h3>
                </div>
                <div class="section-card-body">
                  <div class="document-viewer">
                    <jhi-document-viewer [documentDictionaryId]="doc" />
                  </div>
                </div>
              </div>
            }
          }
        </div>
      </section>
    }
  } @else {
    <p class="text-center" jhiTranslate="entity.application_detail.not_found"></p>
  }
</div>
