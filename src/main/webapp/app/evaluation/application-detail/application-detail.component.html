<div class="page-container">
  <div class="page-header">
    <h1 jhiTranslate="evaluation.reviewHeader">Applications - Review</h1>
  </div>
  <jhi-search-filter-sort-bar
    [searchText]="'evaluation.searchFilterSortBar.searchText' | translate"
    [totalRecords]="totalRecords()"
    [singleEntity]="'evaluation.application' | translate"
    [multipleEntities]="'evaluation.applications' | translate"
    (searchOutput)="onSearchEmit($event)"
    (filterOutput)="onFilterEmit($event)"
    (sortOutput)="loadOnSortEmit($event)"
    [filters]="[
      {
        filterId: 'jobTitle',
        filterLabel: 'evaluation.tableHeaders.job',
        filterSearchPlaceholder: 'evaluation.filterOptions.jobSearchPlaceholder',
        filterOptions: allAvailableJobNames(),
      },
      {
        filterId: 'status',
        filterLabel: 'evaluation.tableHeaders.status',
        filterSearchPlaceholder: 'evaluation.filterOptions.stateSearchPlaceholder',
        filterOptions: availableStatusLabels,
        shouldTranslateOptions: true,
      },
    ]"
    [sortableFields]="sortableFields"
  />
  <div class="body">
    <jhi-application-carousel
      [totalRecords]="totalRecords()"
      [applications]="applications()"
      [currentIndex]="currentIndex()"
      [carouselIndex]="carouselIndex()"
      [carouselSize]="CAROUSEL_SIZE"
      (next)="onNext()"
      (prev)="onPrev()"
    />
    <div class="action-buttons-wrapper">
      <jhi-button
        class="w-full"
        [styleClass]="'w-full'"
        [label]="'evaluation.addToInterview' | translate"
        variant="outlined"
        severity="primary"
        icon="calendar"
        [disabled]="!canReview() || isAlreadyInInterview()"
        (click)="openAddToInterviewDialog()"
      />
      <div class="review-actions">
        <jhi-button
          [label]="'evaluation.accept' | translate"
          variant="outlined"
          severity="success"
          icon="check"
          [disabled]="!canReview()"
          (click)="openAcceptDialog()"
        />
        <jhi-button
          [label]="'evaluation.reject' | translate"
          variant="outlined"
          severity="danger"
          icon="xmark"
          [disabled]="!canReview()"
          (click)="openRejectDialog()"
        />
      </div>
    </div>

    <jhi-dialog
      [visible]="addToInterviewDialogVisible()"
      (visibleChange)="addToInterviewDialogVisible.set($event)"
      header="evaluation.addToInterviewDialog.header"
      [shouldTranslateHeader]="true"
      width="34rem"
    >
      <div class="flex flex-col gap-4">
        <p class="m-0" jhiTranslate="evaluation.addToInterviewDialog.message"></p>
        <div class="flex items-center gap-2">
          <p-checkbox [(ngModel)]="goToManagementAfterAdd" inputId="goToManagement" [binary]="true" size="small" />
          <label for="goToManagement" class="cursor-pointer mb-0" jhiTranslate="evaluation.addToInterviewDialog.goToManagement"></label>
        </div>
        <div class="flex justify-end gap-2 pt-2">
          <jhi-button
            label="entity.action.cancel"
            [shouldTranslate]="true"
            variant="text"
            severity="secondary"
            (click)="addToInterviewDialogVisible.set(false)"
          />
          <jhi-button
            label="evaluation.addToInterviewDialog.confirm"
            [shouldTranslate]="true"
            severity="primary"
            (click)="onAddToInterview()"
          />
        </div>
      </div>
    </jhi-dialog>

    <jhi-review-dialog
      [application]="currentApplication()"
      [(visible)]="reviewDialogVisible"
      [mode]="reviewDialogMode()"
      (accept)="acceptApplication($event)"
      (reject)="rejectApplication($event)"
    />

    @if (currentApplication(); as application) {
      <div class="w-full">
        <div class="grid xl:gap-16 grid-cols-1 xl:grid-cols-[7fr_3fr]">
          <div>
            <jhi-section titleKey="evaluation.details.applicantTitle" icon="user">
              <div class="grid gap-8 md:grid-cols-2">
                <!-- Applicant Information -->
                <jhi-sub-section titleKey="evaluation.details.applicantInformation">
                  <jhi-description-list
                    [items]="[
                      { labelKey: 'evaluation.details.applicantName', value: application.applicationDetailDTO.applicant?.user?.name },

                      {
                        labelKey: 'evaluation.details.applicantGender',
                        value: application.applicationDetailDTO.applicant?.user?.gender
                          ? ('genders.' + application.applicationDetailDTO.applicant?.user?.gender?.toLowerCase() | translate)
                          : '—',
                      },
                      {
                        labelKey: 'evaluation.details.applicantNationality',
                        value: application.applicationDetailDTO.applicant?.user?.nationality
                          ? ('nationalities.' + application.applicationDetailDTO.applicant?.user?.nationality?.toLowerCase() | translate)
                          : '—',
                      },
                    ]"
                  />
                </jhi-sub-section>

                <!-- Links -->
                <jhi-sub-section titleKey="evaluation.details.applicantLinks">
                  <jhi-link-list
                    [links]="[
                      {
                        labelKey: 'evaluation.details.applicantWebsite',
                        url: application.applicationDetailDTO.applicant?.user?.linkedinUrl,
                        icon: 'link',
                      },
                      {
                        labelKey: 'evaluation.details.applicantLinkedIn',
                        url: application.applicationDetailDTO.applicant?.user?.website,
                        icon: 'linkedin',
                        isBrandIcon: true,
                      },
                    ]"
                  />
                </jhi-sub-section>
              </div>
            </jhi-section>

            <p-divider />

            <!-- Education -->
            <jhi-section titleKey="evaluation.details.educationTitle" icon="graduation-cap">
              <div class="grid gap-8 md:grid-cols-2">
                <!-- Bachelor -->
                <jhi-sub-section titleKey="evaluation.details.educationBachelors">
                  <jhi-description-list [items]="bachelorItemsComputed()" />
                </jhi-sub-section>

                <!-- Master -->
                <jhi-sub-section titleKey="evaluation.details.educationMasters">
                  <jhi-description-list [items]="masterItemsComputed()" />
                </jhi-sub-section>
              </div>
            </jhi-section>

            <p-divider />

            <!-- Application -->
            <jhi-section titleKey="evaluation.details.applicationTitle" icon="file">
              <jhi-sub-section titleKey="evaluation.details.applicationDesiredStartDate">
                <span class="text-sm"> {{ (application.applicationDetailDTO.desiredDate | localizedDate) || '—' }} </span>
              </jhi-sub-section>

              <jhi-sub-section titleKey="evaluation.details.applicationMotivation">
                <jhi-prose [text]="application.applicationDetailDTO.motivation" />
              </jhi-sub-section>

              <jhi-sub-section titleKey="evaluation.details.applicationSkills">
                <jhi-prose [text]="application.applicationDetailDTO.specialSkills" />
              </jhi-sub-section>

              <jhi-sub-section titleKey="evaluation.details.applicationProjects">
                <jhi-prose [text]="application.applicationDetailDTO.projects" />
              </jhi-sub-section>
            </jhi-section>
          </div>

          <p-divider class="block xl:hidden" />

          <div>
            <jhi-section titleKey="evaluation.details.documentTitle" icon="file-lines">
              <jhi-document-section [idsDTO]="currentDocumentIds()" [applicationId]="currentApplicationId()" />
            </jhi-section>
          </div>
        </div>
        <p-divider />
        <div class="grid gap-16 grid-cols-1 md:grid-cols-[3fr_7fr]">
          <div>
            <jhi-section titleKey="evaluation.details.ratingTitle" icon="star">
              <jhi-rating-section [applicationId]="currentApplicationId()" />
            </jhi-section>
          </div>
          <div>
            <jhi-section titleKey="evaluation.details.commentTitle" icon="comments">
              <jhi-comment-section [applicationId]="currentApplicationId()" />
            </jhi-section>
          </div>
        </div>
      </div>
    }
  </div>
</div>
