<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

  <changeSet id="024-job-description-i18n" author="Cathy">
    <!-- 1) Add new columns -->
    <addColumn tableName="jobs">
      <column name="job_description_en" type="TEXT"/>
      <column name="job_description_de" type="TEXT"/>
    </addColumn>

    <!-- 2) Migrate old job_description into EN -->
    <sql dbms="mysql">
      UPDATE jobs
      SET job_description_en = job_description
      WHERE (job_description_en IS NULL OR job_description_en = '')
        AND job_description IS NOT NULL
        AND job_description &lt;&gt; '';
    </sql>

    <!-- 3) Drop old column -->
    <dropColumn tableName="jobs" columnName="job_description"/>
  </changeSet>

</databaseChangeLog>
