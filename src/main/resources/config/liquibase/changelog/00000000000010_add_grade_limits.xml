<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

<changeSet id="rg_migrate_grading_scale_to_limits" author="kiara-copony">
  <!-- Add new columns for grade limits -->
  <addColumn tableName="applicants">
    <column name="bachelor_grade_upper_limit" type="VARCHAR(10)"/>
  </addColumn>
  
  <addColumn tableName="applicants">
    <column name="bachelor_grade_lower_limit" type="VARCHAR(10)"/>
  </addColumn>
  
  <addColumn tableName="applicants">
    <column name="master_grade_upper_limit" type="VARCHAR(10)"/>
  </addColumn>
  
  <addColumn tableName="applicants">
    <column name="master_grade_lower_limit" type="VARCHAR(10)"/>
  </addColumn>

  <!-- Migrate existing data: Set default values for ONE_TO_FOUR scale -->
  <sql>
    UPDATE applicants 
    SET bachelor_grade_upper_limit = '1.0', 
        bachelor_grade_lower_limit = '4.0'
    WHERE bachelor_grading_scale = 'ONE_TO_FOUR';
  </sql>

  <sql>
    UPDATE applicants 
    SET master_grade_upper_limit = '1.0', 
        master_grade_lower_limit = '4.0'
    WHERE master_grading_scale = 'ONE_TO_FOUR';
  </sql>

  <!-- Drop old grading scale columns -->
  <dropColumn tableName="applicants" columnName="bachelor_grading_scale"/>
  <dropColumn tableName="applicants" columnName="master_grading_scale"/>
</changeSet>

</databaseChangeLog>
